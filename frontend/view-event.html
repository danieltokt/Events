<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–±—ã—Ç–∏—è - Event Management</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìÖ</text></svg>">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1>Event Management</h1>
                <div class="header-actions">
                    <span class="user-greeting" id="userGreeting"></span>
                    <button class="btn btn-secondary btn-sm" onclick="logout()">–í—ã–π—Ç–∏</button>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="view-container">
                <div class="view-header">
                    <button class="btn btn-secondary" onclick="window.location.href='events.html'">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                    </button>
                    <!-- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π (–±—É–¥–µ—Ç —Å–∫—Ä—ã—Ç –µ—Å–ª–∏ –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü) -->
                    <div class="view-actions" id="actionButtons" style="display: none;">
                        <button class="btn btn-secondary" id="editBtn">
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button class="btn btn-danger" id="deleteBtn">
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>

                <div id="loadingState" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏—è...</div>

                <div id="eventDetails" class="event-details" style="display: none;">
                    <h1 id="eventTitle"></h1>
                    <div class="event-meta-large">
                        <div class="event-meta-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <div>
                                <strong>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</strong>
                                <span id="eventStartDate"></span>
                            </div>
                        </div>
                        <div class="event-meta-item" id="endDateContainer" style="display: none;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <div>
                                <strong>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</strong>
                                <span id="eventEndDate"></span>
                            </div>
                        </div>
                        <div class="event-meta-item" id="locationContainer" style="display: none;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            <div>
                                <strong>–ú–µ—Å—Ç–æ:</strong>
                                <span id="eventLocation"></span>
                            </div>
                        </div>
                        <div class="event-meta-item" id="categoryContainer" style="display: none;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                <line x1="7" y1="7" x2="7.01" y2="7"></line>
                            </svg>
                            <div>
                                <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong>
                                <span id="eventCategory"></span>
                            </div>
                        </div>
                        <!-- ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–∑–¥–∞—Ç–µ–ª—è —Å–æ–±—ã—Ç–∏—è -->
                        <div class="event-meta-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <div>
                                <strong>–ê–≤—Ç–æ—Ä:</strong>
                                <span id="eventCreator"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="event-description-section">
                        <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                        <p id="eventDescription"></p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="notification" class="notification"></div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
            <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ?</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-danger" onclick="confirmDelete()">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/events.js"></script>
    <script>
        // Check authentication
        checkAuth();
        
        // Load user info
        const user = getCurrentUser();
        if (user) {
            document.getElementById('userGreeting').textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.username}!`;
        }
        
        // Get event ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('id');
        
        if (!eventId) {
            showNotification('ID —Å–æ–±—ã—Ç–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
            setTimeout(() => window.location.href = 'events.html', 2000);
        } else {
            loadEventData();
        }
        
        async function loadEventData() {
            try {
                const event = await getEvent(eventId);
                const currentUser = getCurrentUser();
                
                // ‚úÖ –ì–õ–ê–í–ù–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º
                const isOwner = currentUser && event.created_by_id === currentUser.id;
                
                // Populate details
                document.getElementById('eventTitle').textContent = event.title;
                document.getElementById('eventStartDate').textContent = formatDate(event.start_date);
                document.getElementById('eventCreator').textContent = event.created_by_name;
                
                if (event.end_date) {
                    document.getElementById('endDateContainer').style.display = 'flex';
                    document.getElementById('eventEndDate').textContent = formatDate(event.end_date);
                }
                
                if (event.location) {
                    document.getElementById('locationContainer').style.display = 'flex';
                    document.getElementById('eventLocation').textContent = event.location;
                }
                
                if (event.category) {
                    document.getElementById('categoryContainer').style.display = 'flex';
                    document.getElementById('eventCategory').textContent = getCategoryLabel(event.category);
                }
                
                document.getElementById('eventDescription').textContent = 
                    event.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
                
                // Show details
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('eventDetails').style.display = 'block';
                
                // ‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–ª–∞–¥–µ–ª–µ—Ü —Å–æ–±—ã—Ç–∏—è
                if (isOwner) {
                    document.getElementById('actionButtons').style.display = 'flex';
                    
                    document.getElementById('editBtn').onclick = () => {
                        window.location.href = `edit-event.html?id=${eventId}`;
                    };
                    
                    document.getElementById('deleteBtn').onclick = () => {
                        document.getElementById('deleteModal').style.display = 'flex';
                    };
                }
                
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏—è', 'error');
                setTimeout(() => window.location.href = 'events.html', 2000);
            }
        }
        
        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
        }
        
        async function confirmDelete() {
            try {
                await deleteEvent(eventId);
                showNotification('–°–æ–±—ã—Ç–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ', 'success');
                setTimeout(() => window.location.href = 'events.html', 1500);
            } catch (error) {
                // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫—É 403
                if (error.response?.status === 403) {
                    showNotification('–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ', 'error');
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è', 'error');
                }
                closeDeleteModal();
            }
        }
        
        function getCategoryLabel(category) {
            const labels = {
                'conference': '–ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è',
                'workshop': '–ü—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ',
                'meetup': '–°–æ–±—Ä–∞–Ω–∏–µ',
                'webinar': '–í–µ–±–∏–Ω–∞—Ä',
                'other': '–î—Ä—É–≥–æ–µ'
            };
            return labels[category] || category;
        }
    </script>
</body>
</html>